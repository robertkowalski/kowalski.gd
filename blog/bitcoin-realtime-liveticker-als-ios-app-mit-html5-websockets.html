
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <title>Bitcoin Realtime Liveticker als iOS App mit HTML5 Websockets</title>
  <meta name="author" content="Robert Kowalski" />
  <!-- Homepage CSS -->
  <meta name="google-site-verification" content="vzd_Qx8aTVcPM4CvUaiUc4dwGtU5enYVAqYotJEdYjY" />
  <link rel="stylesheet" href="/assets/css/styles-min.css" type="text/css" />

  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
  <link rel="alternate" type="application/atom+xml" title="kowalski.gd atom feed" href="/atom.xml" />
  <link rel="alternate" type="application/rss+xml" title="kowalski.gd RSS feed" href="/rss.xml">
  <link rel="canonical" href="http://kowalski.gd">
</head>
<body>

  <div class="site">
    <div class="title">
      <a href="/">robert kowalski</a>

      <!--a class="extra" href="/archive.html">Archive</a-->
      <!--a class="extra" href="">Pages</a-->
      <!--a class="extra" href="/categories.html">Categories</a-->
      <!--a class="extra" href="/tags.html">Tags</a-->
      <a class="extra" href="http://theclibook.com">The CLI Book</a>
      <a class="extra" href="/imprint.html">Impressum</a>
    </div>

    
<div id="post">
  <h1>Bitcoin Realtime Liveticker als iOS App mit HTML5 Websockets</h1>
  <p class="meta">
    29 March 2013 
    
  </p>
  <p>Das Websocket-Protokoll ist eine relativ neue HTML5-Technologie. Im Prinzip ist es eine Vollduplexverbindung mit Hilfe eines Sockets. So müssen Clients nicht mehr regelmäßig beim Server anfragen um Updates vom Server zu bekommen, wodurch der gesamte Overhead beim Aufbau einer Verbindung entfällt.</p>

<!-- more -->

<p>Heute möchte ich eine relativ simple iOS Applikation mit Hilfe von Phonegap bauen um zu zeigen, wie einfach Websockets zu benutzen sind. Für den Produktionsbetrieb fehlt aber unter anderem die Behandlung von Fehlern, auch habe ich nicht getestet, wie sich der Akku des iPhone&#39;s bei einer Websocketverbindung verhält.</p>

<p>Bitcoin ist eine digitale Währung. Mt Gox bietet eine Websocket Api für ihren Kurs von Bitcoins an.</p>

<p>Der Kern der Anwendung besteht eigentlich aus diesem JavaScript:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#result&#39;</span><span class="p">),</span>
    <span class="nx">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="s1">&#39;ws://websocket.mtgox.com:80/mtgox?Channel=ticker&#39;</span><span class="p">),</span>
    <span class="nx">json</span><span class="p">;</span>

<span class="nx">socket</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">json</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
  <span class="nx">result</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">ticker</span><span class="p">.</span><span class="nx">last</span><span class="p">.</span><span class="nx">display</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p>Im ersten Schritt holen wir uns das DOM-Element, in dem wir das Ergebnis anzeigen wollen.</p>

<p>Danach erstellen wir eine Verbindung zum Websocketserver, und wählen dabei den Channel für den Liveticker aus.</p>

<p>Bei jedem Ergebnis, was uns der Server schickt wird der onmessage Callback aufgerufen.</p>

<p>In <code>event.data</code> finden wir einen Text, den wir in ein JSON Objekt umwandeln und aus dem wir uns dann den <code>display</code>-Wert für den letzten Kurs holen und als <code>innerText</code> in das result-Element schreiben:</p>

<p>Ein wenig CSS dazu, fertig ist die Realtime Bitcoin iOS App.</p>

<p><img src="/assets/images/bitcoin-liveticker.png" alt="Ein Bild der HTML5 Applikation auf dem iPhone" /></p>

<p>Das Xcode-Projekt findet ihr unter: <a href="https://github.com/robertkowalski/bitcoin-app-demo" rel="nofollow">https://github.com/robertkowalski/bitcoin-app-demo</a></p>

<p><img src="http://vg09.met.vgwort.de/na/3ede50dee7a7486291d15cd2fc14575b" width="1" height="1" alt=""></p>

</div>

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li class="small-bordered">
        <span class="small-hide">10 Feb 2016&raquo; </span>
        <a href="/blog/high-performance-erlang-finding-bottlenecks-couchdb-1">High Performance Erlang - Finding Bottlenecks in a CouchDB Cluster #1</a>
      </li>
    
      <li class="small-bordered">
        <span class="small-hide">09 Oct 2015&raquo; </span>
        <a href="/blog/software-development-in-cuba">Software development in Cuba</a>
      </li>
    
      <li class="small-bordered">
        <span class="small-hide">02 Mar 2015&raquo; </span>
        <a href="/blog/what-happened-while-contributing-to-open-source-on-a-daily-basis-for-one-year">What happened while contributing to Open Source on a daily basis for one year</a>
      </li>
    
  </ul>
</div>





    <div class="footer">
      <div class="contact">
        <p>
          Robert Kowalski<br />
          <br />
          rok@kowalski.gd
        </p>
      </div>
      <div class="contact">
        <p>
          <a href="http://github.com/robertkowalski/">github.com/robertkowalski</a><br />
          <a href="http://twitter.com/robinson_k/">twitter.com/robinson_k</a><br />
        </p>
      </div>
    </div>
  </div>

  


  <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-28167405-1', 'auto');
  ga('set', 'anonymizeIp', true);
  ga('send', 'pageview');
</script>




</body>
</html>

